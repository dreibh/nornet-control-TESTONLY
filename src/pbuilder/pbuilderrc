DISTRIBUTION=trusty
COMPONENTS="main universe"

MIRRORSITE=http://no.archive.ubuntu.com/ubuntu/
OTHERMIRROR="deb http://ppa.launchpad.net/dreibh/ubuntu $DISTRIBUTION main"

# OTHERMIRROR="deb http://no.archive.ubuntu.com/ubuntu/ main restricted universe multiverse"
# OTHERMIRROR="deb http://ppa.launchpad.net/dreibh/ubuntu $DISTRIBUTION main"


# NOTE: To create the base installation, run:
# sudo pbuilder create --debootstrapopts --variant=buildd --keyring /etc/apt/trusted.gpg

# NOTE: Upon changes, run:
# sudo pbuilder update --override-config


# Trust
APTKEYRINGS=( '/etc/apt/trusted.gpg' )
DEBOOTSTRAPOPTS=( '--variant=buildd' '--keyring' '/etc/apt/trusted.gpg' )
# NOTE: pbuilder seems to ignore these settings!
# Then, ALLOWUNTRUSTED=yes "solves" the problem to build VirtualBox (needs kbuild).
# This is, of course, not a good solution!
# ALLOWUNTRUSTED=yes

# Turn OFF ccache! It will not work properly!
CCACHEDIR=

# Multi-core:
cores=`getconf _NPROCESSORS_ONLN`
#if [ "${cores}" -gt "1" ]; then
#    cores=$((${cores}-1))
#fi
# Set concurrency level. The packaging scripts will handle it properly:
export CONCURRENCY_LEVEL=${cores}
# This will not work (unlimited number of processes for kernel build!):
# !!! DO NOT USE !!! DEBBUILDOPTS="-j${cores}"

# =================================================================

mkdir -p /var/cache/pbuilder/hook.d

HOOKDIR="/var/cache/pbuilder/hook.d"

cat >/var/cache/pbuilder/hook.d/C10shell <<EOF
#!/bin/sh
# invoke shell if build fails.

apt-get install -y --force-yes vim less bash joe
cd /tmp/buildd/*/debian/..
/bin/bash < /dev/tty > /dev/tty 2> /dev/tty
EOF

sudo chmod a+x /var/cache/pbuilder/hook.d/C10shell

# =================================================================
