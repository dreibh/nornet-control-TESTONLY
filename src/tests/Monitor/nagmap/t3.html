<html>
<head>

<title>Velkommen til NorNet-Kontrollsenter p√• Simula, Fornebu</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Author" content="Thomas Dreibholz" />
<meta name="Description" content="NorNet-Kontrollsenter" />
<meta name="Keywords" content="NorNet-Kontrollsenter, NorNet Project, NorNet Prosjekt, Simula Research Laboratory, Thomas Dreibholz" />
<meta name="Classification" content="Kontrollsenter" />
<link rel="stylesheet" href="stylesheet.css" type="text/css" />
<link rel="shortcut icon" href="graphics/icons/icon-uniessen.png" />

<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
<script src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>


<html>
<head>
<script type="text/javascript">


// ###### Check existence of variable given by its name #####################
function variableExists(variable)
{
   return(eval("typeof(" + variable + ")") != "undefined");
}


// ###### Get content of variable given by its name #########################
function getVariable(variable)
{
   var value;
   eval("value=(" + variable + ");");
   return(value);
}


// ###### Set content of variable given by its name #########################
function setVariable(variable, value)
{
   eval(variable + "=value;");
}


// ###### Initialize NorNet map #############################################
function makeMap(latitude, longitude, zoomLevel)
{
   // If rendering in standards-compliant mode, no map will be shown. The
   // height seems to be 0. When this function gets called, the layout has
   // already been rendered. Then, add another <div> for the map => works.
   document.getElementById("map_canvas").innerHTML = '<div id="my_map_canvas" style="width: 100%; height: 100%;">Map</div>';

   window.map = new OpenLayers.Map({
      div:               "my_map_canvas",
      numZoomLevels:     15,
      units:             "m",
      displayProjection: new OpenLayers.Projection("EPSG:4326"),
      controls: [
         new OpenLayers.Control.Navigation(),
         new OpenLayers.Control.PanZoomBar(),
         new OpenLayers.Control.LayerSwitcher({'ascending':false}),
         new OpenLayers.Control.Permalink(),
         new OpenLayers.Control.ScaleLine(),
         new OpenLayers.Control.Permalink('permalink'),
         new OpenLayers.Control.MousePosition(),
         new OpenLayers.Control.OverviewMap(),
         new OpenLayers.Control.KeyboardDefaults()
      ]
   });

   window.googlemap  = new OpenLayers.Layer.Google("Google", { type: google.maps.MapTypeId.HYBRID });

   window.mapnik     = new OpenLayers.Layer.OSM.Mapnik("Mapnik");
   window.mapnik.setOpacity(1.0);

   window.mapmarkers = new OpenLayers.Layer.Markers("Sites");
   window.mapvectors = new OpenLayers.Layer.Vector("Connections");

   window.map.addLayers([
      window.mapnik,
      window.googlemap,
      window.mapvectors,
      window.mapmarkers
   ]);

   window.map.setCenter(new OpenLayers.LonLat(longitude, latitude).transform(
                           new OpenLayers.Projection("EPSG:4326"), window.map.getProjectionObject()),
                        zoomLevel);
}


// ###### Remove position ###################################################
function removePosition(positionVariable)
{
   setVariable(positionVariable, null);
}


// ###### Create position ###################################################
function makePosition(positionVariable, latitude, longitude)
{
   removePosition(positionVariable);
   position = new OpenLayers.LonLat(longitude, latitude).transform(
                 new OpenLayers.Projection("EPSG:4326"), window.map.getProjectionObject());
   setVariable(positionVariable, position);
}


// ###### Remove marker #####################################################
function removeMarker(markerVariable)
{
   if (variableExists(markerVariable) && (getVariable(markerVariable) != null)) {
      var marker = getVariable(markerVariable);
      window.mapmarkers.removeMarker(marker);
      setVariable(markerVariable, null);
   }
}


// ###### Create marker #####################################################
function makeMarker(markerVariable, title, icon, positionVariable, zIndex)
{
   removeMarker(markerVariable);
   var marker = new OpenLayers.Marker(getVariable(positionVariable),
                                      new OpenLayers.Icon(icon));
   window.mapmarkers.addMarker(marker);
   setVariable(markerVariable, marker);
}


// ###### Remove connection #################################################
function removeConnection(connectionVariable)
{
   if (variableExists(connectionVariable) && (getVariable(connectionVariable) != null)) {
      var connection = getVariable(connectionVariable);
      window.mapvectors.removeFeatures([connection], true);
      setVariable(connectionVariable, null);
   }
}

// ###### Create connection #################################################
function makeConnection(connectionVariable, points, color, thickness, zIndex)
{
   removeConnection(connectionVariable);
   var linePoints = [];
   for(i = 0;i < points.length; i++) {
      linePoints[i] = new OpenLayers.Geometry.Point(points[i].lon, points[i].lat);
   }
   var lineString = new OpenLayers.Geometry.LineString(linePoints);
   var connection = new OpenLayers.Feature.Vector(lineString, null, {
         strokeColor:   color,
         strokeOpacity: 0.9,
         strokeWidth:   thickness
      });
   window.mapvectors.addFeatures([connection]);

   setVariable(connectionVariable, connection);
}



var x1=null;


function test2() {
   makePosition("window.p2", 50+ ((10 * Math.random()) - 5), 10+ ((10 * Math.random()) - 5));
   makePosition("window.p1", 70+ ((10 * Math.random()) - 5), 20+ ((10 * Math.random()) - 5));
   makeMarker("window.x1",  "Test 1", "http://www.google.com/mapfiles/marker_green.png", "window.p1", 1);
   makeMarker("window.xx1", "Test 2", "http://www.google.com/mapfiles/marker_green.png", "window.p2", 1);

   makeConnection("qqq", [ window.p1, window.p2 ], "orange", 5, 10);

}

function runTest()
{
   makeMap(60, 5, 4);

   test2();

   setInterval("test2();", 2500);
}

</script>

</head>
<body onload="runTest();">

Status:<br />
<div id="test1">???</div><br/>
<div id="test2">???</div><br/>
<div id="map_canvas" style="width:100%; height:80%">...</div>

</body>
</html>
