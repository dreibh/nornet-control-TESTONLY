#!/usr/bin/python
# -*- coding: utf-8 -*-
#
# NorNet API Test
# Copyright (C) 2012 by Thomas Dreibholz
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# Contact: dreibh@simula.no


import sys;
import xmlrpclib;
import re;
import os;
import hashlib;
import datetime;

# Needs package python-ipaddr (Fedora Core, Ubuntu, Debian)!
from ipaddr import IPAddress, IPv4Address, IPv4Network, IPv6Address, IPv6Network;

# NorNet
from NorNetTools         import *;
from NorNetAPI           import *;
from NorNetProviderSetup import *;
from NorNetSiteSetup     import *;
from NorNetConfiguration import *;



# ###########################################################################




# ###########################################################################


# Beta Tunnelbox
makeTunnelboxBootstrap(2, 1, '132.252.156.71', 'tunnelbox')


log('***** This is NorNet version 1.0! *****')
loginToPLC()

fullSiteList = fetchNorNetSiteList()


makeProviderConfiguration()
makeNorNetConfiguration(False)


node = fetchNorNetNode('altenessen.gamma.site')
if node != None:
   makeNodeConfiguration(fullSiteList, node, None, 'Debian', None)
   makeNodeConfiguration(fullSiteList, node, 'p2p1', 'Fedora', None)

node = fetchNorNetNode('sognsvann.beta.site')
if node != None:
   makeNodeConfiguration(fullSiteList, node, 'p2p1', 'Fedora', None)

node = fetchNorNetNode('fornebu.alpha.site')
if node != None:
  makeNodeConfiguration(fullSiteList, node, 'eth0', 'Fedora', None)

makeNodeConfigurationForGivenNode(fullSiteList, fullSiteList[1], 'plc.alpha.site', 21, 'eth0', 'Fedora', None)



#myNorNetInformation = getMyNorNetInformation()
#if myNorNetInformation == None:
   #error('Unable to get information about my site, provider and node. Check IP configuration!')

#try:
   #site = fullSiteList[myNorNetInformation['site_index']]
#except:
   #error('Unable to find my site!')

#makeTunnelBoxConfiguration(fullSiteList, site, 'tunnelbox', False)
